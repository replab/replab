
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/open-sans/stylesheet.css" />
  <!-- Licensed under the SIL Open Font License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/source-serif-pro/source-serif-pro.css" />
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap-theme.min.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>Doctests guide &#8212; RepLAB 0.9.5-SNAP documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/guzzle.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/collapse_helper.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Style guide" href="style.html" />
    <link rel="prev" title="API Documentation style guide" href="api_documentation_style.html" /> 
  
   
  
<style type="text/css">
  ul.ablog-archive {
    list-style: none;
    overflow: auto;
    margin-left: 0px;
  }
  ul.ablog-archive li {
    float: left;
    margin-right: 5px;
    font-size: 80%;
  }
  ul.postlist a {
    font-style: italic;
  }
  ul.postlist-style-disc {
    list-style-type: disc;
  }
  ul.postlist-style-none {
    list-style-type: none;
  }
  ul.postlist-style-circle {
    list-style-type: circle;
  }
</style>

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../mat-modindex.html" title="MATLAB Module Index"
             >matlab index</a> |</li>
        <li class="right" >
          <a href="style.html" title="Style guide"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="api_documentation_style.html" title="API Documentation style guide"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">RepLAB 0.9.5-SNAP documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Development/Community</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Doctests guide</a></li> 
      </ul>
    </div>
    <div class="container-wrapper">

      <div id="mobile-toggle">
        <a href="#"><span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span></a>
      </div>
  <div id="left-column">
    <div class="sphinxsidebar"><div class="text-logo">
  <a href="
    ../index.html">RepLAB</a>&nbsp;&nbsp;
  <a href="https://github.com/replab/replab"><i class="fab fa-github"></i></a>&nbsp;
  <a href="https://github.com/replab/replab/archive/v0.9.5-SNAP.zip"><i class="fa fa-download"></i></a>&nbsp;
  <a href="https://gitter.im/replab/replab"><i class="fab fa-gitter"></i></a>&nbsp;
  <a href="https://travis-ci.com/replab/replab"><i class="fas fa-sync-alt"></i></a>&nbsp;
  <a href="https://codecov.io/gh/replab/replab"><i class="fas fa-umbrella"></i></a>
</div><div class="sidebar-block">
  <div class="sidebar-toc">
    
    
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howto/index.html">How to</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic/index.html">Topic guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../publications/index.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">Technical Reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Development/Community</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="abbreviations.html">Abbreviations in RepLAB</a></li>
<li class="toctree-l2"><a class="reference internal" href="organization.html">Code organization and release process</a></li>
<li class="toctree-l2"><a class="reference internal" href="api_documentation_style.html">API Documentation style guide</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Doctests guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#expected-output">Expected output</a></li>
<li class="toctree-l3"><a class="reference internal" href="#values-in-expected-output">Values in expected output</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="style.html">Style guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="scope.html">Scope of the RepLAB project</a></li>
<li class="toctree-l2"><a class="reference internal" href="docker.html">Docker Octave image</a></li>
<li class="toctree-l2"><a class="reference internal" href="sphinx.html">Sphinx tips and tricks</a></li>
<li class="toctree-l2"><a class="reference internal" href="octave_bugs.html">Octave bugs</a></li>
<li class="toctree-l2"><a class="reference internal" href="project_ideas.html">Project ideas</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../blog/index.html">Blog</a></li>
</ul>

    
  </div>
</div>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2><a href="../blog.html">Recent Blog Posts</a></h2>
  </div>
  <div class="sidebar-toc">
    <ul>
      
      
      <li class="toctree-l1"><a href="../blog/20210724-RepFuN.html">24 July - A fun application of RepLAB : solving combination puzzles</a></li>
      
      <li class="toctree-l1"><a href="../blog/20200123-RepLAB-website-live.html">26 January - The RepLAB documentation and the infrastructure behind it</a></li>
      
    </ul>
  </div>
</div>

      
    </div>
  </div>
        <div id="right-column">
          
          <div role="navigation" aria-label="breadcrumbs navigation">
            <ol class="breadcrumb">
              <li><a href="../index.html">Docs</a></li>
              
                <li><a href="index.html">Development/Community</a></li>
              
              <li>Doctests guide</li>
            </ol>
          </div>
          
          <div class="document clearer body">
             <section id="doctests-guide">
<h1>Doctests guide<a class="headerlink" href="#doctests-guide" title="Permalink to this headline">¶</a></h1>
<p>(Work in progress)</p>
<p>Doctests are generated by recursing the source files and looking for <code class="docutils literal notranslate"><span class="pre">Example:</span></code> Sphinx directives in the comments.
The corresponding Sphinx block, as defined by its indentation, represents a single doctest.
A doctest is composed of a series of statements.</p>
<p>Each statement is composed of a command and its expected output.
The first line of the statement has the following structure:</p>
<p><code class="docutils literal notranslate"><span class="pre">&gt;&gt;&gt;</span> <span class="pre">command-text</span> <span class="pre">[...]</span> <span class="pre">[%</span> <span class="pre">[comment-text]</span> <span class="pre">[doctest:</span> <span class="pre">flags]]</span></code></p>
<p>where:</p>
<ul class="simple">
<li><p>The first three characters, <code class="docutils literal notranslate"><span class="pre">&gt;&gt;&gt;</span></code> define the start of a statement.</p></li>
<li><p>The command text <code class="docutils literal notranslate"><span class="pre">command-text</span></code> is MATLAB/Octave code.</p></li>
<li><p>The command text is optionally terminated by <code class="docutils literal notranslate"><span class="pre">...</span></code>, in which case the command text of the next line will be concatenated.</p></li>
<li><p>An optional comment, which will be stripped from the constructed doctest. However, only on the first line of a statement,
the comment may contain a <code class="docutils literal notranslate"><span class="pre">doctest:</span></code> substring, and the part of the comment following that substring will be interpreted as statement flags.</p></li>
</ul>
<p>If a statement line representing a comment has its command part ending with <code class="docutils literal notranslate"><span class="pre">...</span></code>, the next line is of the form:</p>
<p>``    command-text […] [% [comment-text]]``</p>
<p>and such lines are concatenated to the first as long as they end with <code class="docutils literal notranslate"><span class="pre">...</span></code>. Flags are only parsed on the first line of a statement.</p>
<p>A statement is followed by the expected output, which can be empty. The expected test output ends</p>
<ol class="arabic simple">
<li><p>when the next line is no longer a comment line,</p></li>
<li><p>when another comment line starts with <code class="docutils literal notranslate"><span class="pre">&gt;&gt;&gt;</span></code>,</p></li>
<li><p>when two blank comment lines are provided.</p></li>
</ol>
<p>The <code class="docutils literal notranslate"><span class="pre">command-text</span></code> can have different forms, and the expected output is interpreted accordingly.</p>
<section id="expected-output">
<h2>Expected output<a class="headerlink" href="#expected-output" title="Permalink to this headline">¶</a></h2>
<p>In expected test output, blank lines are ignored. Errors are not captured, and will crash the test handler.</p>
<p>Test files are written in the MoXUnit format, using functions and subfunctions as the rest of the RepLAB test suite; helpers functions are used to verify the test output.</p>
<p>Our inspiration for the framework comes from <a class="reference external" href="http://doc.sagemath.org/html/en/developer/coding_basics.html#writing-testable-examples">http://doc.sagemath.org/html/en/developer/coding_basics.html#writing-testable-examples</a>.</p>
<p>We distinguish the following three kinds of statements.</p>
<section id="silent-statements">
<h3>Silent statements<a class="headerlink" href="#silent-statements" title="Permalink to this headline">¶</a></h3>
<p>A silent statement finishes with a semicolumn. It can be of the form <code class="docutils literal notranslate"><span class="pre">statement;</span></code> or <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">=</span> <span class="pre">statement;</span></code> or <code class="docutils literal notranslate"><span class="pre">[a,</span> <span class="pre">b]</span> <span class="pre">=</span> <span class="pre">statement;</span></code>.</p>
<p>In that case, the text written to the standard output/error streams is captured and compared to the data provided by the doctest.</p>
</section>
<section id="repl-statements">
<h3>REPL statements<a class="headerlink" href="#repl-statements" title="Permalink to this headline">¶</a></h3>
<p>A REPL statement is a non-assigning statement which does not finish with a semicolumn: it is of the form <code class="docutils literal notranslate"><span class="pre">statement</span></code>, and is expected to returns a single output. If the command does not return any output (as would an <code class="docutils literal notranslate"><span class="pre">assert</span></code> do, for example), it should be followed by a semicolon in the form of a silent statement instead.</p>
<p>There are two forms of expected output for REPL statements. The long form is used when the command displays text on the standard output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">verbose_f</span><span class="p">()</span>
<span class="go">    Log: computing the f value</span>
<span class="go">    ans =</span>
<span class="go">      1</span>
</pre></div>
</div>
<p>where the <code class="docutils literal notranslate"><span class="pre">ans</span> <span class="pre">=</span></code> line separates what the code displays on the standard output (before the <code class="docutils literal notranslate"><span class="pre">ans</span> <span class="pre">=</span></code>) line, and what the returned value is (here, <code class="docutils literal notranslate"><span class="pre">1</span></code>).</p>
<dl>
<dt>The short form is used when the code does not display anything on the standard output. In that case, the expected output is just the returned value::</dt><dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">silent_f</span><span class="p">()</span>
<span class="go">    1</span>
</pre></div>
</div>
</dd>
</dl>
<p>We diverge from the Matlab output conventions in one case. When we display the value of a variable, without assignment, we do not repeat the variable name. The following would be a valid Matlab session:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="o">&gt;&gt;</span> <span class="n">x</span>
<span class="n">x</span> <span class="o">=</span>
     <span class="mi">2</span>
</pre></div>
</div>
<p>whereas the corresponding doctest would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span>
<span class="go">    2</span>
</pre></div>
</div>
</section>
<section id="assignment-statements">
<h3>Assignment statements<a class="headerlink" href="#assignment-statements" title="Permalink to this headline">¶</a></h3>
<p>A command of an assignment statement is of one of the forms:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">=</span> <span class="pre">statement</span></code>, in which case the value of the variable <code class="docutils literal notranslate"><span class="pre">a</span></code> is captured and compared to the doctest data;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[a,</span> <span class="pre">b]</span> <span class="pre">=</span> <span class="pre">statement</span></code>, in which case several variables are captured and compared to the doctest data.</p></li>
</ul>
<p>These statements do not finish with a semicolumn. The expected output contains first the text written by the command to the standard output, if any, before the value of each of the variables, where the value of each variable is preceded by a <code class="docutils literal notranslate"><span class="pre">varname</span> <span class="pre">=</span></code> line.</p>
<dl>
<dt>For example::</dt><dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">verbose_f</span><span class="p">()</span>
<span class="go">    Log: computing the f value</span>
<span class="go">    a =</span>
<span class="go">      1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="mi">2</span>
<span class="go">    a =</span>
<span class="go">      2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">deal</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="go">    a =</span>
<span class="go">      1</span>
<span class="go">    b =</span>
<span class="go">      2</span>
</pre></div>
</div>
</dd>
<dt>Note that, in the case of a single output and no text output on the standard output, the short form is also accepted:</dt><dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">silent_f</span><span class="p">()</span>
<span class="go">    1</span>
</pre></div>
</div>
</dd>
</dl>
</section>
</section>
<section id="values-in-expected-output">
<h2>Values in expected output<a class="headerlink" href="#values-in-expected-output" title="Permalink to this headline">¶</a></h2>
<p>For now, we support the following types in the expected output.</p>
<section id="strings">
<h3>Strings<a class="headerlink" href="#strings" title="Permalink to this headline">¶</a></h3>
<p>Strings are char row vectors. In the expected output, they can be described in two ways:</p>
<ul class="simple">
<li><p>They are written between single quotes as in <code class="docutils literal notranslate"><span class="pre">'between</span> <span class="pre">quotes'</span></code>, and quotes in the string are doubled (as in the standard Matlab string syntax: <code class="docutils literal notranslate"><span class="pre">'String</span> <span class="pre">with</span> <span class="pre">a</span> <span class="pre">''double''</span> <span class="pre">quote'</span></code>). In that case, the string must not contain newline characters.</p></li>
<li><p>They are written without a beginning single quote, and they can be multiline.</p></li>
</ul>
</section>
<section id="scalars">
<h3>Scalars<a class="headerlink" href="#scalars" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">double</span></code> expected values are parsed using eval and compared for equality (the NaN case is not supported yet?)</p></li>
<li><p><a class="reference internal" href="../api/numerics.html#+replab.cyclotomic" title="+replab.cyclotomic"><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">replab.cyclotomic</span></code></a> expected scalars are written as expressed by the <a class="reference internal" href="../api/numerics.html#+replab.cyclotomic.num2str" title="+replab.cyclotomic.num2str"><code class="xref mat mat-obj docutils literal notranslate"><span class="pre">replab.cyclotomic.num2str</span></code></a> method.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vpi</span></code> expected values are written on one line as a base 10 string</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">logical</span></code> expected values are evaluated by <code class="docutils literal notranslate"><span class="pre">eval</span></code> and converted to the logical type</p></li>
</ul>
</section>
</section>
</section>

<div class="section">
   
</div>

          </div>
            
  <div class="footer-relations">
    
      <div class="pull-left">
        <a class="btn btn-default" href="api_documentation_style.html" title="previous chapter (use the left arrow)">API Documentation style guide</a>
      </div>
    
      <div class="pull-right">
        <a class="btn btn-default" href="style.html" title="next chapter (use the right arrow)">Style guide</a>
      </div>
    </div>
    <div class="clearer"></div>
  
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../mat-modindex.html" title="MATLAB Module Index"
             >matlab index</a> |</li>
        <li class="right" >
          <a href="style.html" title="Style guide"
             >next</a> |</li>
        <li class="right" >
          <a href="api_documentation_style.html" title="API Documentation style guide"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">RepLAB 0.9.5-SNAP documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Development/Community</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Doctests guide</a></li> 
      </ul>
    </div>
<script type="text/javascript">
  $("#mobile-toggle a").click(function () {
    $("#left-column").toggle();
  });
</script>
<script type="text/javascript" src="../_static/js/bootstrap.js"></script>
  <div class="footer">
    &copy; Copyright 2018-2021, Denis Rosset, Jean-Daniel Bancal and collaborators. Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
  </body>
</html>